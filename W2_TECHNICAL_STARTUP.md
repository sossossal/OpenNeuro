# Stage 2 - 第二周 (W2) 技术启动与工作计划

**时间**: 2026年1月27日 - 2月2日  
**状态**: 🚀 本周正式启动  
**阶段**: Stage 2 技术执行 - 编码与设计阶段

---

## 📅 周日程表

### 周一 (1月27日) - 架构评审与启动

#### 上午 (10:00-11:00) - 日常站会
```
参与者: CTO, Lead Dev, 硬件负责人, PM
时间: 10:00-10:30

议程:
├─ W1 完成情况总结 (5min)
├─ W2 目标确认 (5min)
├─ 分组工作分配 (10min)
├─ 问题&风险识别 (5min)
└─ 下周目标确认 (5min)
```

#### 下午 (14:00-16:00) - 全面设计评审
```
参与者: 全体技术团队 + 可选 Guest Reviewer
地点: 线上会议 / 会议室

议程:

1️⃣ [14:00-14:30] PTP 架构评审
   ├─ 演讲人: Lead Dev
   ├─ 内容:
   │  ├─ 5 层分层架构核心设计
   │  ├─ Master/Slave 状态机
   │  ├─ PI Servo 算法可行性
   │  └─ 跨平台适配方案
   ├─ 评审点:
   │  ├─ 状态转移是否完备?
   │  ├─ 消息处理流程是否清晰?
   │  └─ API 是否足够简洁?
   └─ 预期产出: 设计批准或修改清单

2️⃣ [14:30-15:00] TSN 算法评审
   ├─ 演讲人: Lead Dev (网络部分)
   ├─ 内容:
   │  ├─ 门控调度时间周期设计
   │  ├─ 流量分类与优先级
   │  ├─ 带宽预留算法
   │  └─ Linux tc/taprio 集成方案
   ├─ 评审点:
   │  ├─ 性能目标 (<100µs RT) 是否可达?
   │  ├─ Linux 兼容性如何保证?
   │  └─ 硬件交换机支持方案?
   └─ 预期产出: 算法批准或优化方向

3️⃣ [15:00-15:30] 硬件设计评审
   ├─ 演讲人: 硬件负责人
   ├─ 内容:
   │  ├─ 电源系统 (MP2107 降压器配置)
   │  ├─ 网络接口 (RTL8211FD 硬件时间戳)
   │  ├─ 成本分析 (¥350 目标)
   │  └─ PCB 设计计划 (W2-W4)
   ├─ 评审点:
   │  ├─ PCB 成本目标可达?
   │  ├─ PTP 硬件时间戳设计充分?
   │  └─ 元器件供应链风险?
   └─ 预期产出: 硬件方向批准

4️⃣ [15:30-16:00] Q&A + 开发计划确认
   ├─ 讨论与问答
   ├─ W2 重点工作分配最终确认
   └─ 编码启动确认
```

### 周二-周四 (1月28日-30日) - 核心开发

#### 上午 (09:00-12:00) - 集中编码时段

```
任务分配:

PTP Team (2 人)
├─ 任务 1: 消息定义与构造 (messages.h/c)
│  ├─ ANNOUNCE 消息构造 (1h)
│  ├─ SYNC + FOLLOW_UP (1h)
│  ├─ DELAY_REQ/RESP (30min)
│  └─ 单元测试 (30min)
│  📊 LOC 目标: 150+
│
├─ 任务 2: BMC 算法实现 (bmc.h/c)
│  ├─ Grandmaster 比较函数 (30min)
│  ├─ 状态转移决策 (30min)
│  └─ 单元测试 (30min)
│  📊 LOC 目标: 100+
│
└─ 任务 3: 时钟管理 (clock.h/c)
   ├─ 时间维护结构体 (20min)
   ├─ 硬件计数器集成 (30min)
   └─ 单元测试 (20min)
   📊 LOC 目标: 80+

TSN Team (2 人)
├─ 任务 1: 优先级队列 (queue.h/c)
│  ├─ 队列数据结构 (30min)
│  ├─ 入队/出队操作 (30min)
│  └─ 单元测试 (30min)
│  📊 LOC 目标: 120+
│
├─ 任务 2: 门控调度算法 (scheduler.c)
│  ├─ 时间槽计算函数 (30min)
│  ├─ 门控决策逻辑 (45min)
│  └─ 单元测试 (30min)
│  📊 LOC 目标: 150+
│
└─ 任务 3: Linux 基础框架 (taprio_if.h)
   ├─ 接口定义 (30min)
   └─ 初步实现框架 (30min)
   📊 LOC 目标: 80+

硬件 Team (1 人)
├─ 任务 1: KiCad 项目初始化
│  ├─ 项目结构建立 (30min)
│  ├─ 库与模型配置 (30min)
│  └─ 原理图模板设置 (20min)
│
└─ 任务 2: 电源系统原理图
   ├─ MP2107 配置 (45min)
   ├─ 输入/输出保护 (30min)
   └─ 审查与验证 (15min)
   📊 目标: Sheet 1 完成
```

#### 下午 (14:00-17:00) - 同步与审查

```
14:00-14:30   代码审查与集成
              ├─ 拉取最新代码
              ├─ 构建与单元测试运行
              └─ 集成问题讨论

14:30-15:00   临时问题解决时间
              └─ 阻塞问题快速解决

15:00-16:00   技术分享与知识转移
              ├─ 今日发现的关键问题
              ├─ 代码片段演示
              └─ 最佳实践分享

16:00-17:00   计划下一天工作
              ├─ 当日进度总结
              ├─ 明日优先级
              └─ 工具/环境问题反馈
```

### 周五 (2月2日) - 周度评审与规划

#### 上午 (10:00-12:00) - 周度技术站会

```
议程:

1️⃣ [10:00-10:30] PTP 周进度
   ├─ 代码行数统计 (目标: 200+)
   ├─ 单元测试覆盖率 (目标: 40%+)
   ├─ 发现的问题与解决方案
   └─ W3 计划预告

2️⃣ [10:30-11:00] TSN 周进度
   ├─ 队列与调度框架完成度
   ├─ 测试运行结果
   ├─ Linux 集成第一步完成情况
   └─ W3 计划预告

3️⃣ [11:00-11:30] 硬件设计周进度
   ├─ 原理图完成度 (目标: 50%)
   ├─ 元器件采购进展
   ├─ 成本计算更新
   └─ W3 计划预告

4️⃣ [11:30-12:00] 下周规划 & 关键决策
   ├─ 各 Team W3 目标确认
   ├─ 资源调整 (如需要)
   └─ 风险预警 (如有)
```

#### 下午 (14:00-15:00) - 代码审查总结

```
内容:
├─ 完整代码审查 (Pull Request 评审)
├─ 代码质量指标汇总
│  ├─ 代码行数分布
│  ├─ 测试覆盖率
│  ├─ Bug/Issue 统计
│  └─ 代码复杂度指标
└─ 改进建议与计划
```

---

## 🎯 W2 关键目标

### 技术目标

```
PTP Master 实现 (200+ LOC)
├─ ✅ 消息定义与构造
├─ ✅ BMC 算法完整实现
├─ ✅ 时钟维护与状态机框架
├─ ✅ 40%+ 单元测试覆盖率
└─ 📊 代码行数: 200+ (分布: 消息 50, BMC 40, 时钟 30, 测试 80)

TSN 调度器框架 (220+ LOC)
├─ ✅ 优先级队列实现
├─ ✅ 门控调度算法
├─ ✅ 基础 Linux 适配框架
├─ ✅ 40%+ 单元测试覆盖率
└─ 📊 代码行数: 220+ (分布: 队列 60, 调度 90, 框架 40, 测试 70)

硬件设计启动
├─ ✅ KiCad 项目完全配置
├─ ✅ 电源系统原理图完成 (50%)
├─ ✅ 元器件 BOM 更新与采购清单
└─ 📊 进度: 原理图 50% 完成

质量指标
├─ ✅ 所有新代码通过编译
├─ ✅ 无内存泄漏 (Valgrind/ASan)
├─ ✅ 单元测试全部通过
└─ ✅ 代码规范符合项目标准
```

### 里程碑

| 日期 | 任务 | 交付物 | 评估 |
|------|------|--------|------|
| 1月27日 | 架构评审 & 启动 | 评审记录 + 反馈 | ✅ |
| 1月28日 | PTP 核心框架 | messages.c/h | 🔄 |
| 1月29日 | BMC 算法 | bmc.c/h | 🔄 |
| 1月30日 | 时钟与集成 | clock.c/h | 🔄 |
| 1月31日 | TSN 队列 & 调度 | queue/scheduler.c | 🔄 |
| 2月2日 | W2 周度评审 | 进度报告 & PR | 🔄 |

---

## 📋 开发工作流规范

### 代码管理

```bash
# 分支策略
main                    # 生产版本 (保护分支)
├─ develop              # 开发主干
│  ├─ feature/ptp-master-1    # 新功能分支
│  ├─ feature/tsn-queue
│  └─ bugfix/issue-123
└─ release/v0.2.0-w2    # 发布分支

# 每日操作流程
1. git pull origin develop
2. git checkout -b feature/your-task
3. [编码 & 本地测试]
4. git commit -m "feat(ptp): implement ANNOUNCE message"
5. git push origin feature/your-task
6. [创建 Pull Request]
7. [代码审查 & CI 检查]
8. [合并到 develop]
```

### 代码审查清单

```
☐ 代码能否编译 (无警告)
☐ 单元测试覆盖率 >40%
☐ 函数注释完整 (说明、参数、返回值)
☐ 命名规范一致 (ptp_*, tsn_*)
☐ 无内存泄漏 (如适用)
☐ 遵循项目风格指南
☐ 提交消息清晰且有意义
```

### 每日 Standup 模板

```
【日期】2026-01-28
【参与】Alice (PTP), Bob (TSN), Charlie (HW)

【Alice 报告】(PTP Master)
昨日完成:
  ✅ 完成 ANNOUNCE 消息构造 (50 LOC)
  ✅ 编写单元测试 (30 LOC)
今日计划:
  🔄 实现 SYNC + FOLLOW_UP 消息
  🔄 DELAY_REQ/RESP 处理
障碍/风险:
  ⚠️ 时间戳精度细节需确认
  ✅ 已与硬件团队沟通

【Bob 报告】(TSN Scheduler)
昨日完成:
  ✅ 优先级队列数据结构定义
  ✅ 基本 enqueue/dequeue 实现 (60 LOC)
今日计划:
  🔄 完成队列单元测试
  🔄 实现门控调度算法
障碍/风险:
  ⚠️ 时间精度需硬件确认
  ✅ Linux 相关库已确认

【Charlie 报告】(Hardware)
昨日完成:
  ✅ KiCad 项目初始化
  ✅ 库与符号导入
今日计划:
  🔄 完成电源系统原理图
  🔄 元器件 BOM 整理
障碍/风险:
  ⚠️ RTL8211FD 库需验证
  ✅ MP2107 数据手册已查阅
```

---

## 📊 W2 开发环境检查清单

### 编译环境

```
☐ GCC/Clang 最新版本
☐ CMake 3.10+
☐ 构建工具链
  ☐ GNU Make 4.0+
  ☐ Ninja (可选)
☐ 依赖库
  ☐ libnl (Linux 网络)
  ☐ gtest (单元测试)
  ☐ Valgrind/ASan (内存检查)
```

### 版本控制

```
☐ Git 最新版本
☐ SSH 密钥配置
☐ Git 用户配置 (name + email)
☐ .gitignore 配置完备
☐ GitHub access token (如需要)
```

### 硬件工具

```
☐ KiCad 8.0+
☐ 符号库与封装库
☐ 参考设计文件
☐ 元器件数据手册 (PDF)
```

### CI/CD 检查

```
☐ GitHub Actions 工作流配置
☐ 自动构建脚本
☐ 单元测试自动运行
☐ 代码覆盖率报告 (codecov)
☐ 静态分析 (Clang-Tidy)
```

---

## 🚀 快速启动步骤

### 1. 获取代码

```bash
cd ~/projects
git clone https://github.com/OpenNeuro/OpenNeuro.git
cd OpenNeuro
git checkout develop
```

### 2. 构建项目

```bash
# PTP 项目
cd ptp-stack
mkdir build && cd build
cmake ..
make
make test

# TSN 项目
cd ../../tsn-scheduler
mkdir build && cd build
cmake ..
make
make test

# 硬件项目
cd ../../zone-controller/hardware/kicad
# 使用 KiCad GUI 打开 zone-controller.pro
```

### 3. 验证环境

```bash
# 检查 PTP 构建
./build/test_ptp --verbose

# 检查 TSN 构建
./build/test_tsn --verbose

# 检查编辑器
kicad --version
```

### 4. 创建你的第一个分支

```bash
git checkout -b feature/ptp-messages
# 开始编码...
```

---

## 📞 联系与支持

**技术疑问**: GitHub Issues (标签: w2-help)  
**紧急阻塞**: Slack 通知  
**代码审查**: Pull Request 评论  
**设计讨论**: GitHub Discussions  

---

**文档版本**: v1.0  
**最后更新**: 2026-01-20  
**下一次审查**: 2026-02-02
