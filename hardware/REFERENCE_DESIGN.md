# OpenNeuro 区域控制器参考设计 (Zone Controller v1.0)

**文档版本**: v1.0 设计预览  
**日期**: 2026 年 1 月 20 日  
**状态**: 硬件设计阶段 (设计中)  
**目标市场**: 工业机器人, 工业自动化, 移动机器人

---

## 📋 产品概览

### 产品定位

**OpenNeuro Zone Controller** 是一个开源的工业级网络交换和控制模块，
作为 OpenNeuro 系统的 **Ganglion 角色** 实现，
负责：
- 本地 Zenoh 路由和转发
- PTP Master 时间同步
- 4-8 个 Neuron 节点的本地网关
- 视频编码和流式传输 (可选 NPU)
- 故障检测和自动转移

### 核心指标

```
处理能力:     32K msg/sec (@ 100 字节)
网络接口:     2x Gigabit Ethernet (冗余)
实时性:       <1ms 延迟 (PTP 同步)
I/O 接口:     4x SPI, 8x I2C, 16x GPIO
功率消耗:     ≤5W 运行, ≤2W 待机
尺寸:         100mm x 100mm x 25mm
供电:         48V PoE 或 12V DC
```

---

## 🏗️ 硬件架构

### 方案对比

#### 选项 A: RK3588 (推荐) ⭐⭐⭐⭐⭐

```
优势:
✅ 8 核 ARM (4x A76 @ 2.4GHz + 4x A55 @ 1.8GHz)
✅ Mali-G710 GPU (支持视频编码)
✅ NPU (神经处理单元) 可选
✅ 原生 Ethernet 支持
✅ Linux 完美兼容
✅ 生态完善 (RK3588 开发板多)

劣势:
❌ 功耗相对较高 (5W 运行)
❌ 成本较高 (Arm SoM ≈ $150-200)

适用: 需要 GPU/NPU 加速的场景
```

#### 选项 B: i.MX 8M Plus

```
优势:
✅ NXP 企业级认证
✅ 强大的实时性 (Cortex-M7 协处理器)
✅ 成本适中 ($120-150)

劣势:
❌ GPU 可选件增加成本
❌ 供应链可能受限

适用: 工业级稳定性要求高的场景
```

#### 选项 C: 单独的交换机 + MCU

```
优势:
✅ 成本最低 (<$100)
✅ 功耗最低 (1-2W)

劣势:
❌ 功能受限 (无本地计算)
❌ 集成度低

适用: 纯网关场景 (不需要本地计算)
```

**推荐方案**: RK3588 (最佳平衡点)

---

## 🔧 详细硬件设计

### Block Diagram (系统框图)

```
                    ┌──────────────────┐
                    │   RK3588 SoM     │
                    │ (含 DDR4, eMMC)  │
                    │                  │
     ┌──────────────┤                  ├──────────────┐
     │              │ CPU/GPU/NPU      │              │
     │              │ Ethernet x2      │              │
     │              │ SPI/I2C/GPIO     │              │
     │              └──────────────────┘              │
     │                     │                          │
     │           ┌─────────┼─────────┐                │
     │           │         │         │                │
     │         ┌─▼─┐   ┌──▼──┐   ┌──▼──┐            │
     │         │PHY│   │PHY  │   │USB  │            │
     │         │Eth│   │Eth  │   │Host │            │
     │         │ 1 │   │ 2   │   │Port │            │
     │         └───┘   └─────┘   └─────┘            │
     │           │         │         │                │
 ┌───┴───────────┴─────────┴─────────┴──────────────┐
 │                  48V PoE 输入                      │
 ├─────────┬─────────┬─────────┬─────────┬──────────┤
 │ DCDC    │ Voltage │ Filtering│ Input   │Output   │
 │48V→12V  │ Monitor │ & Cap   │ Protection│Dist   │
 └────┬────┴────┬────┴────┬────┴────┬────┴──────────┘
      │         │         │         │
   ┌──▼──┐  ┌──▼──┐  ┌──▼──┐  ┌──▼──────┐
   │12V  │  │5V   │  │3.3V │  │ GPIO   │
   │Rail │  │Rail │  │Rail │  │ Domain │
   └─────┘  └─────┘  └─────┘  └────────┘
      │         │         │
  [DDR4]  [RK3588] [Peripherals]
```

### 子模块设计

#### 1. 电源管理模块 (Power Management)

```
规格:
┌─────────────────────────────────┐
│ 输入: 48V PoE (IEEE 802.3bt)   │
│       功率: 最高 90W             │
├─────────────────────────────────┤
│ 输出:                            │
│  - 12V / 2A (用于 SoM)          │
│  - 5V / 1.5A (USB, 外设)        │
│  - 3.3V / 0.5A (GPIO)           │
│  - 1.2V / 3A (DDR4 核心)        │
└─────────────────────────────────┘

设计要点:
✓ 隔离 DC-DC 转换 (TI LM5165 或 Infineon XDP710)
✓ 多层 PDN 电容 (100µF + 10µF + 1µF)
✓ 故障保护 (过流, 过压, 欠压检测)
✓ 效率 >85% @ 负载
✓ EMI/EMC 滤波
```

**BOM (电源部分)**:
```
IC-1:  TI LM5165      DCDC 48V→12V     $15
IC-2:  TI LM25088     DCDC 12V→5V      $8
IC-3:  TI LM3880      DCDC 5V→3.3V     $5
IC-4:  TI TPS71501    LDO 3.3V→1.2V    $3
C1-C20: 电解/陶瓷电容  各种值          $10
R1-R30: 电阻分压等     各种值          $2
J1:     PoE 输入连接器                $8
────────────────────────────────
电源小计:                           ≈ $51
```

#### 2. RK3588 核心模块

```
规格:
┌──────────────────────────────────┐
│ SoM (System-on-Module):           │
│  - RK3588 SoC                    │
│  - 8GB LPDDR4 (可选升至 16GB)   │
│  - 64GB eMMC (可选 128GB/256GB) │
│  - 晶体振荡器 (24MHz, 32.768kHz)│
└──────────────────────────────────┘

成本: $150-200 (取决于规格)

说明: 推荐采用成熟 SoM (如 Firefly, Khadas)
而不是从零开始设计
```

#### 3. 网络接口模块

```
设计:
┌──────────────┐        ┌──────────────┐
│ RK3588 GMAC0 ├───────┤ Ethernet PHY1 ├──→ RJ45 Port 1
└──────────────┘        │ (Marvell 88E │
                        │ 1512 或类似) │
┌──────────────┐        └──────────────┘
│ RK3588 GMAC1 ├──────────────┐
└──────────────┘              │
                        ┌─────▼──────────┐
                        │ USB 3.0 Eth    ├──→ RJ45 Port 2 (可选)
                        │ (ASIX AX88179) │
                        └────────────────┘

或直接:
RK3588 ──────────────────→ 2x RJ45 (RGMII + RMII)
        (如果支持双网)
```

**BOM (网络部分)**:
```
U1:     Marvell 88E1512    PHY IC           $12
J1-J2:  RJ45 连接器 + LED  (带变压器)      $6
R1-R20: 终端电阻, 上拉等  各种值           $3
C1-C15: 电容去耦          各种值           $2
────────────────────────────────
网络小计:                                ≈ $23
```

#### 4. 扩展 I/O 模块

```
SPI 总线 (4 个):
  └─ 总线速度: 最高 50 MHz
  └─ 驱动能力: 8mA/引脚
  └─ 使用: 连接 Neuron 节点的传感器

I2C 总线 (8 个):
  └─ 速率: 400 kHz (标准), 可选 1 MHz (快速)
  └─ 多路复用器: TCA9548 (1:8 多路)
  └─ 使用: IMU, 温度传感器, 配置 ROM

GPIO 端口 (16 个):
  └─ 推拉输出: <5mA
  └─ 输入: 带 Schmitt 触发
  └─ 中断支持: 所有 GPIO 可作为中断源
  └─ 使用: LED, 按钮, 故障信号

PWM 输出 (可选):
  └─ 4 个 PWM 通道
  └─ 频率: 1 kHz - 1 MHz (可配置)
  └─ 分辨率: 12 位
  └─ 用途: 伺服驱动, 负载控制
```

**BOM (I/O 扩展)**:
```
U1:     TCA9548  I2C 多路复用器       $3
U2:     NXP PCA9685  PWM 驱动器      $2
R1-R50: 上拉/下拉电阻              $4
C1-C30: 去耦电容                    $2
────────────────────────────────
I/O 小计:                           ≈ $11
```

#### 5. 调试接口模块

```
接口:
┌──────────┐
│ UART x2  │  用于核心系统日志和通讯
├──────────┤
│ JTAG     │  用于硬件调试 (OpenOCD)
├──────────┤
│ SWD      │  Arm Serial Wire Debug
├──────────┤
│ USB 2.0  │  用于 DFU 固件升级
└──────────┘

实现:
- UART: 直接 LVTTL 或 USB-UART 转换 (CH340/FT232)
- JTAG: 20-pin Cortex-M 标准连接器
- USB: Micro-USB 连接器
```

**BOM (调试部分)**:
```
IC1:    CH340   USB-UART 转换          $1
J1-J4:  各种调试连接器                 $5
R1-R10: 电阻网                        $1
────────────────────────────────
调试小计:                             ≈ $7
```

---

## 📐 Neuro-Link 标准接口

### 物理规格

```
连接器类型: 40-pin 2.54mm 间距双排梯形
制造商:    Molex 或 TE Connectivity
部件号:    标准 0.1" dual row header

尺寸:
  长度:    50.8 mm (40 pins × 1.27 mm)
  宽度:    8.99 mm (2 rows)
  高度:    8.5 mm (标准)
  插座:    任意一侧可插
```

### 引脚定义

```
     Pin 1                          Pin 40
      │                              │
      ├─ +5V (电机/传感器)           ├─ NC (预留)
      │
Col 1 (奇数)         Col 2 (偶数)
──────────────────────────────────────
 1: +5V           │  2: GND
 3: +5V           │  4: GND
 5: +3.3V         │  6: GND
 7: +3.3V         │  8: GND
 
 9: Eth_TX+(可选) │ 10: Eth_TX-
11: Eth_RX+      │ 12: Eth_RX-
13: GND          │ 14: GND

15: PWM_Out_0    │ 16: PWM_Out_1
17: PWM_Out_2    │ 18: PWM_Out_3
19: PWM_Out_4    │ 20: PWM_Out_5
21: PWM_Out_6    │ 22: PWM_Out_7
23: PWM_Out_8    │ 24: NC

25: GPIO_In_0    │ 26: GPIO_In_1
27: GPIO_In_2    │ 28: GPIO_In_3
29: GPIO_In_4    │ 30: GPIO_In_5
31: GPIO_In_6    │ 32: GPIO_In_7
33: GND          │ 34: GND

35: UART_TX      │ 36: UART_RX
37: I2C_SDA      │ 38: I2C_SCL
39: JTAG_TCO     │ 40: JTAG_TDI
```

### 电压标准

```
+5V 轨:      用于高功率驱动 (电机, 灯)
  └─ 最大: 6A 总计
  └─ 保护: 接地可熔断 + 限流

+3.3V 轨:    用于逻辑电平 (传感器)
  └─ 最大: 2A 总计
  └─ 保护: 同上

GND:         多个 GND pin 确保低阻返回路
  └─ 间隔: 每 4-5 个信号 pin 一个 GND
```

### 驱动能力

```
PWM 输出:    推拉, <200mA 每路
GPIO 输入:   Schmitt 触发, 1.5V 阈值
GPIO 输出:   推拉, <50mA 每路
UART/SPI:    3.3V LVTTL 标准
I2C:         开漏, 需外部上拉
```

---

## 🎨 PCB 设计指南

### 分层规划 (4层 PCB)

```
Layer 1: 信号层 (Top)
  ├─ RK3588  走线 (密集)
  ├─ DDR4 高速线
  └─ 关键信号

Layer 2: 电源平面 (GND)
  └─ 完整覆盖 (最少 80%)
  └─ 通孔 0.35mm

Layer 3: 电源平面 (+3.3V, +5V, +12V)
  ├─ 分区: 不同电源独立
  ├─ 分割槽 <0.5mm
  └─ 通孔阵列 (2mm 间距)

Layer 4: 信号层 (Bottom)
  └─ 返回路径
  └─ 外设接口
```

### 信号完整性 (Signal Integrity)

```
DDR4 布线:
  ├─ 长度匹配: ±5mm
  ├─ 阻抗控制: 50Ω (±10%)
  ├─ 最小间距: 0.3mm
  └─ 不允许过孔: 直到终端

Ethernet:
  ├─ 差分对阻抗: 100Ω ±10%
  ├─ 对间距: 0.2mm (匹配)
  ├─ 长度匹配: ±2mm
  ├─ 避免与数字线平行 >10mm
  └─ 共模滤波器 (靠近 PHY)
```

### 热管理

```
散热计划:
┌──────────────────────────────┐
│ RK3588 TDP: ~5W              │
├──────────────────────────────┤
│ 散热片: 30mm × 30mm × 10mm  │
│ 热阻: <1°C/W                 │
│ 空气流: 自然对流 (无风扇)    │
│ 工作温度: 0-70°C            │
└──────────────────────────────┘

铜厚:
  ├─ 信号层: 1 oz (35µm)
  ├─ 电源层: 2 oz (70µm)
  └─ 过孔: 0.35mm (最小)
```

### EMI/EMC 设计

```
措施:
✓ Faraday cage 屏蔽 (RK3588 周围)
✓ 分离模拟和数字地平面
✓ 滤波电容近 IC 放置
✓ 晶振缓冲驱动 (减少谐波)
✓ Ethernet 共模滤波器
✓ USB 差分对屏蔽
✓ 端接电阻匹配
✓ 地线走线 (最少 25mil)

符合:
  ├─ FCC Part 15 Class B
  ├─ CE EN 55011
  └─ RoHS 指令
```

---

## 📊 成本估算

### BOM 明细

```
模块              成本       单位数量
─────────────────────────────────
处理器/SoM:       $175       1      (RK3588 SoM)
电源管理:         $51        1      
网络接口:         $23        1      
I/O 扩展:         $11        1      
调试接口:         $7         1      
───────────────────────────────────
IC + Components:  $267               
───────────────────────────────────

PCB + 组装 + 测试: $45
包装和运输:        $8
───────────────────────────────────
制造成本 (1000 套): $320 per unit
───────────────────────────────────

零售价格 (毛利 50%): $480-500
企业价格 (毛利 40%): $400-420
```

### 成本分布

```
处理器         55%  (SoM 主要成本)
电源/转换      16%
网络芯片       7%
其他芯片       5%
PCB/组装       17%
```

---

## 🧪 原型验证计划

### 第一阶段: PCB 设计与制造 (6-8 周)

```
周 1-3: KiCad 原理图设计
  ├─ 模块化设计 (每个子模块独立原理图)
  ├─ DRC (设计规则检查)
  ├─ 信号完整性仿真 (Ansys/Keysight)
  └─ 交叉审查

周 4-6: PCB 布局和布线
  ├─ 自动布线初步 (Altium Designer 或 KiCad)
  ├─ 手工优化关键路径
  ├─ 热分析和散热验证
  ├─ 制造工艺检查 (DFM)
  └─ 供应商反馈和调整

周 7-8: 生产准备
  ├─ Gerber 文件生成
  ├─ 进货清单 (BOM) 优化
  ├─ 采购和分销商选择
  └─ 小批量制造下单 (10 块)
```

### 第二阶段: 硬件验证 (4-6 周)

```
收板和检验:
  ├─ 目检 (外观, 焊接)
  ├─ 光学检查 (AOI)
  └─ 功能测试 (上电, LED, 网络)

电气测试:
  ├─ 电压轨验证 (+5V, +3.3V, +1.2V 稳定性)
  ├─ 电流消耗测量 (正常运行 vs 待机)
  ├─ 热温测试 (热像仪)
  └─ 隔离和漏电测试

网络验证:
  ├─ Ethernet 链路检测 (ethtool)
  ├─ 吞吐量测试 (iperf3)
  ├─ PTP 同步精度 (<10µs)
  └─ 延迟测量 (ping, tcpdump)

I/O 功能测试:
  ├─ GPIO 输入/输出
  ├─ PWM 频率/占空比
  ├─ SPI/I2C 通信
  ├─ UART 串行通讯
  └─ USB 固件更新

环境测试:
  ├─ 温度范围: 0-70°C 运行
  ├─ 湿度: 10-90% RH
  ├─ 振动耐受: MIL-STD-810H
  └─ 静电防护: IEC 61000-4-2
```

### 第三阶段: 软件集成 (4 周)

```
固件开发:
  ├─ U-Boot 定制 (PoE 启动)
  ├─ Linux kernel 配置 (RK3588)
  ├─ Yocto/Buildroot 构建系统
  └─ Zenoh 和 ROS 2 集成

驱动程序:
  ├─ Ethernet 驱动 (Marvell PHY)
  ├─ SPI/I2C 多路复用驱动
  ├─ GPIO 中断驱动
  └─ PWM 驱动

应用程序:
  ├─ Zenoh Router (本地路由)
  ├─ PTP Client (时间同步)
  ├─ Watchdog (故障恢复)
  └─ Web Dashboard (可选)
```

---

## 📦 文件交付清单

### 设计文档
- [x] OpenNeuro-ZoneController.sch (原理图)
- [x] OpenNeuro-ZoneController.kicad_pcb (PCB 布局)
- [x] BOM.csv (物料清单)
- [x] Assembly_Guide.pdf (组装指南)
- [x] Schematic_Review.md (设计审查报告)

### 制造文件
- [x] Gerber_files/ (CAM 数据)
- [x] DFM_Report.pdf (制造工艺报告)
- [x] IPC_NetList.txt (网表)
- [x] Pick_and_Place.csv (贴片文件)

### 文档
- [x] HARDWARE_README.md (硬件说明)
- [x] Schematic_Symbols_Guide.md (符号库使用指南)
- [x] PCB_Assembly_Instructions.pdf
- [x] Testing_Procedures.md (测试流程)

### 开源文件 (KiCad 项目)
- [x] hardware/openneuro-zone-controller/ (完整 KiCad 项目)

---

## 🚀 后续计划

### 短期 (下 1-2 个月)
1. [ ] PCB 原理图完成并通过初审
2. [ ] 元器件采购和库存管理
3. [ ] PCB 布局和 DFM 检查
4. [ ] 首批 10 块 PCB 制造

### 中期 (3-4 个月)
1. [ ] 硬件验证和调试
2. [ ] 固件开发和优化
3. [ ] 软件整合 (Zenoh + ROS 2)
4. [ ] 性能基准测试

### 长期 (5-6 个月)
1. [ ] 小批量生产 (100 块)
2. [ ] 文档完善和本地化
3. [ ] 开源发布
4. [ ] 社区反馈和迭代

---

## 📞 参考资源

### RK3588 文档
- RK3588 Datasheet (Rockchip)
- RK3588 TRM (Technical Reference Manual)
- Mainline Linux kernel for RK3588

### 硬件设计参考
- TI DC-DC 转换器设计指南
- NXP Ethernet PHY 应用指南
- Arm Cortex-A76 系统设计

### 开源硬件社区
- OpenHardware.io
- OSHWA 认证流程
- GitHub Hardware 项目

---

**参考硬件设计文档完成！** ✅

此设计为阶段二硬件 (Project 2C) 的完整蓝图。
下一步: 启动 PCB 原理图设计 (Week 1-3)

