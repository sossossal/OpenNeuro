# Zone Controller - 硬件架构设计文档

## 📋 文档概述

本文档定义了 OpenNeuro Zone Controller 的硬件架构、电路设计规范、BOM 清单和设计约束。

**文档版本**: v1.0  
**创建日期**: 2026年1月20日  
**目标发布**: 2026年9月 (v1.0 量产版)

---

## 🏗️ 系统架构

### 硬件框图

```
┌─────────────────────────────────────────────────────────────┐
│                     ZONE CONTROLLER                         │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │            RK3588 SoC 系统                           │   │
│  │  ├─ CPU: 8-core ARM Cortex (A76/A55)               │   │
│  │  ├─ GPU: Mali-G610 MP4                             │   │
│  │  ├─ RAM: 8GB LPDDR5                                │   │
│  │  ├─ eMMC: 256GB 存储                                │   │
│  │  └─ 整合网络 MAC + PHY                              │   │
│  └─────────────────────────────────────────────────────┘   │
│           │                            │                      │
│           ▼                            ▼                      │
│  ┌────────────────────┐   ┌────────────────────┐            │
│  │  Ethernet Port 1   │   │  Ethernet Port 2   │            │
│  │  (Gigabit, RJ-45) │   │  (Gigabit, RJ-45) │            │
│  │  + PTP 时间戳      │   │  + PTP 时间戳      │            │
│  └────────────────────┘   └────────────────────┘            │
│                                                               │
│  ┌──────────────────────────────────────────────────┐       │
│  │         扩展接口                                  │       │
│  │  ├─ USB 3.0 x2 (5 Gbps)                          │       │
│  │  ├─ PCIe 3.0 x4 (16 Gbps)                        │       │
│  │  ├─ GPIO 40-pin (RPI 兼容)                       │       │
│  │  ├─ UART x2 (调试)                               │       │
│  │  └─ SPI/I2C (传感器接口)                          │       │
│  └──────────────────────────────────────────────────┘       │
│                                                               │
│  ┌──────────────────────────────────────────────────┐       │
│  │  电源管理与散热                                  │       │
│  │  ├─ 电源: 12V/24V 宽范围输入                      │       │
│  │  ├─ 转换器: 多个 DC-DC 转换器                     │       │
│  │  ├─ 保护: 过流/过温保护                           │       │
│  │  └─ 散热: 被动散热 + 风扇接口                     │       │
│  └──────────────────────────────────────────────────┘       │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 核心模块

| 模块 | 主要芯片 | 功能 | 规格 |
|------|---------|------|------|
| **处理器** | Rockchip RK3588 | 主计算单元 | 8-core ARM, 8GB RAM |
| **网络 1** | RTL8211FD | Gigabit PHY | 1000 Base-T |
| **网络 2** | RTL8211FD | Gigabit PHY | 1000 Base-T |
| **电源** | MP2107 | DC-DC 降压 | 12V→3.3V, 5A |
| **存储** | Kingston eMMC | 数据存储 | 256GB |
| **USB** | VIA VL817 | USB 集线器 | 3x USB 3.0 |
| **连接器** | 各类 | I/O 扩展 | GPIO/UART/SPI |

---

## 🔌 电气规范

### 电源设计

#### 输入电源
- **输入电压范围**: 10-24V DC
- **推荐工作点**: 12V / 24V
- **最大输入电流**: 3A @ 12V (36W)
- **保护**: 反向极性保护、过流保护、过温保护

#### 电源树 (Power Tree)

```
12V 输入 (3A)
    │
    ├─► 降压转换器 1 (MP2107) → 3.3V, 5A (Max)
    │       │
    │       ├─► SoC 核心电压
    │       ├─► DDR5 内存
    │       ├─► 网络 PHY
    │       └─► GPIO 和传感器接口
    │
    ├─► 降压转换器 2 (MP2107) → 5V, 3A
    │       │
    │       ├─► USB 集线器
    │       ├─► PCIe 接口电压
    │       └─► 风扇电源
    │
    └─► 直接连接 → 12V 设备
            │
            └─► 外部扩展模块
```

#### 电容选择

| 位置 | 电容 | 数量 | 作用 |
|------|------|------|------|
| 输入 | 100µF / 25V | 4 | 输入滤波 |
| 3.3V 输出 | 10µF / 10V | 10 | 输出滤波 |
| 5V 输出 | 10µF / 10V | 8 | 输出滤波 |
| SoC 近端 | 1µF / 10V | 20 | 去耦 |
| DDR 近端 | 1µF / 10V | 15 | 去耦 |

### 网络接口设计

#### Gigabit Ethernet 电路

```
RK3588 RGMII 接口
    │
    ├─► RTL8211FD PHY 芯片
    │       │
    │       ├─► 变压器耦合
    │       │   (HR911105A with Magnetics)
    │       │
    │       └─► RJ-45 连接器
    │           (Cat6a, PoE 就绪)
    │
    └─► 配置信号 (MDIO/MDC)
```

#### PTP 硬件时间戳

- **时间戳精度**: ±10 ns
- **捕获触发**: 网络报文接收/发送中断
- **时间戳源**: SoC 内部 CLOCKSOURCE_ACPI_PM
- **同步时钟**: PTP (IEEE 1588 v2)

### 内存布局

```
8GB LPDDR5 分配:
├─ 1GB - Linux 内核 + 驱动
├─ 2GB - 根文件系统 (RFS)
├─ 3GB - 应用程序堆
├─ 1GB - 网络缓冲区
└─ 1GB - 预留 / 缓存
```

---

## 📦 物料清单 (BOM)

### 完整 BOM 表

```csv
Designator,Part Number,Description,Quantity,Unit Price (¥),Total (¥),Supplier
M1,Orange Pi 5 Plus,RK3588 SoM Module,1,99,99,AliExpress/Taobao
U1,MP2107,3.3V 5A DC-DC Converter,1,8,8,Mouser
U2,MP2107,5V 3A DC-DC Converter,1,8,8,Mouser
U3,RTL8211FD,Gigabit Ethernet PHY,2,15,30,Taobao
U4,VIA VL817,USB 3.0 Hub Controller,1,25,25,Taobao
U5,Kingston eMMC,256GB Storage,1,40,40,Amazon
J1,HR911105A,RJ-45 with Magnetics,2,8,16,RS/Mouser
J2,USB Type-C,Charging Port,1,3,3,AliExpress
J3,GPIO Header,40-pin Connector,1,2,2,Taobao
J4,UART Header,2x2 Pin Header,2,0.5,1,Taobao
J5,SPI Header,6-pin Connector,1,1,1,Taobao
J6,I2C Header,4-pin Connector,1,0.5,0.5,Taobao
SW1,Power Switch,Slide Switch 3A,1,3,3,Taobao
C1-C4,100µF/25V,Bulk Capacitor,4,2,8,Taobao
C5-C13,10µF/10V,Filter Capacitor,10,0.5,5,Taobao
C14-C40,1µF/10V,Decoupling Capacitor,30,0.2,6,Taobao
R1-R50,1K/10K,Resistors,50,0.05,2.5,Taobao
LED1-3,Red/Green/Blue,Status LEDs,3,0.5,1.5,Taobao
CASE,Aluminum Shell,Heatsink Case,1,50,50,Taobao
THERMAL,Thermal Paste,Heat Transfer Compound,1,5,5,Taobao
PCB,Custom PCB,2-layer/4-layer,1,80,80,JLC/Taobao
MISC,Various,Connectors/Screws/etc,1,20,20,Various

TOTAL BOM COST,,,,,¥395.5,
```

### 供应商推荐

| 物料类型 | 推荐供应商 | 链接 | 优点 |
|---------|---------|------|------|
| **芯片** | Mouser | mouser.com | 品质好，支持国际 |
| **模块** | AliExpress | aliexpress.com | 价格便宜 |
| **无源器件** | 立创商城 | lcsc.com | 快速、品质有保证 |
| **PCB** | JLC PCB | jlcpcb.com | 快速、便宜、质量好 |
| **外壳** | Taobao | taobao.com | 定制选项多 |
| **组装** | 捷邦达 | jeaborad.com | 代工服务 |

### 成本优化建议

**当前单价**: ¥395  
**目标成本** (100+ 批量): ¥320
**优化策略**:
1. 采购量增加 → 单价下降 10-15%
2. 国内供应商直购 → 减少中间商 5%
3. 定制 SoM 模块 → 集成度提高 5-8%

---

## 📐 机械设计

### 外壳规格

```
外壳尺寸: 150mm (L) × 100mm (W) × 50mm (H)
材料: 铝合金 (6061-T6)
表面处理: 阳极氧化 (黑色)

I/O 端口布局:
┌─────────────────────────────────────┐
│                    (前面板)           │
│                                       │
│  LED 指示灯 (3 个)                   │
│  ┌─ 电源 (绿)                        │
│  ├─ 网络 1 (黄)                      │
│  └─ 网络 2 (蓝)                      │
│                                       │
└─────────────────────────────────────┘
       (右侧面板)

┌────────┬────────┬────────────┐
│ USB 3.0│ USB 3.0│   Power    │
│   #1   │   #2   │  12V/24V   │
└────────┴────────┴────────────┘

       (背面板)

┌────────────┬────────────┐
│  网络端口  │  网络端口  │
│  Eth-1 RJ45│  Eth-2 RJ45│
│   (黄)     │   (蓝)      │
├────────────┼────────────┤
│   UART     │   GPIO     │
│  (调试)    │  (扩展)    │
└────────────┴────────────┘

       (底部)

┌─────────────────────────────────┐
│  散热孔阵列 (通风)              │
│  ┌─ 防滑垫 (4 个角)             │
│  └─ 安装孔 (4 个)               │
└─────────────────────────────────┘
```

### 散热设计

- **被动散热**: 铝合金外壳 + 散热膏
- **最大功耗**: 30W
- **温升限制**: 工作温度 ≤ 40°C 时，外壳 ≤ 50°C
- **可选主动散热**: 40×40 mm 风扇 (12V, <20dB)

---

## 🧪 验收测试

### 电气测试

```
✓ 电源输入: 12V/24V, 反向保护正常
✓ 电压输出: 3.3V ±5%, 5V ±5%
✓ 漏电流: <10mA
✓ 启动时间: <100ms
✓ 热稳定性: 30min 后温度稳定
```

### 网络测试

```
✓ 网口 1 链接: 1000 Mbps 稳定
✓ 网口 2 链接: 1000 Mbps 稳定
✓ PTP 时间戳: ±10ns 精度
✓ 无丢包: 24h 1Gbps 流量
```

### 功能测试

```
✓ USB 3.0 识别: 5 Gbps 正常
✓ PCIe 链接: Gen3 x4 16 Gbps
✓ GPIO 输出: 40-pin 全部正常
✓ UART 通信: 115200 baud 正常
✓ SPI/I2C: 正常工作
```

### 可靠性测试

```
✓ 老化测试: 48h 连续运行, 无故障
✓ 温度循环: 0°C ~ 40°C, 5 个循环
✓ 电源瞬变: ±10% 电压瞬间变化, 系统稳定
✓ 重启循环: 100 次快速重启, 无故障
```

---

## 📅 开发时间表

| 阶段 | 时间 | 任务 | 交付物 |
|------|------|------|--------|
| **原理图设计** | W1-W2 | 电路设计 + 评审 | 原理图 + 评审记录 |
| **PCB 设计** | W3-W4 | 布局布线 + DFM | PCB 文件 + Gerber |
| **样板制造** | W5-W6 | PCB 制造 + 组装 | 5-10 套样板 |
| **电气验证** | W7 | 性能测试 | 测试报告 |
| **固件集成** | W8-W10 | 驱动开发 + Linux 配置 | 完整固件 |
| **系统测试** | W11-W15 | 性能优化 + 可靠性测试 | 最终测试报告 |
| **文档完善** | W16-W20 | 设计文档 + 用户手册 | 完整文档集 |

---

## ✅ 设计评审清单

- [ ] 电源设计的安全性和效率
- [ ] 网络接口的 EMI/EMC 合规性
- [ ] 散热设计的充分性
- [ ] 物料可获得性和成本合理性
- [ ] 制造工艺的可行性
- [ ] 测试计划的完整性

---

**下一步**: 组织硬件设计评审会议 (2026年1月27日)，启动原理图设计阶段。

**评审参与者**:
- 硬件工程师
- 固件工程师
- 采购人员
- 质量管理人员
